function makeMarker(e){var t=new google.maps.Marker({map:map});return t.setOptions(e),google.maps.event.addListener(t,"click",function(){infoWindow.setOptions(e),infoWindow.open(map,t)}),markerArray.push(t),t}function pinAndDist(e,t,a){var o=google.maps.geometry.spherical.computeDistanceBetween(e,t),n=a.id,i=jQuery("#"+n).data("title"),r=jQuery("#"+n).data("link");venueFromMe[n]=o;var s=new google.maps.Marker({position:t,map:map}),u=[],l="",p="";if(u.push("<a class='button tag' href='"+r+"'>"+i+"</a>"),jQuery(a).children("div").each(function(e,t){var a=jQuery(this).data("title"),o=jQuery(this).data("image"),n=jQuery(this).data("cancel"),i=jQuery(this).data("link"),r=jQuery(this).data("cost"),s=jQuery(this).data("startdate"),l=jQuery(this).data("starttime"),p="<div> <h3> <a href='"+i+"'>"+a+"</a> </h3> <ul class='infobox-list'><li>"+s+", "+l+(""!==r?", Cost: "+r:"")+"</li></ul></div>";u.push(p)}),l=u.join(" "),p="<div class='event_bubble'>"+l+"</div>",google.maps.event.addListener(s,"click",function(){infowindow.setContent(p),infowindow.open(map,this)}),countVenue==venueCount){var c=[];for(var n in venueFromMe)c.push([n,venueFromMe[n]]);c.sort(function(e,t){return e[1]-t[1]});for(var d=0;d<c.length;d++){var m=c[d];jQuery("#venuesWithEvents").append(jQuery("#"+m))}}}function venueGen(e,t){jQuery(".venue").each(function(a,o){var n=jQuery(this).data("title"),i=jQuery(this).data("lat"),r=jQuery(this).data("lng"),s=jQuery(this).data("address"),u,l,p=this;i&&r?(countVenue=++countVenue,u=new google.maps.LatLng(i,r),t(e,u,p)):geocoder.geocode({address:s},function(a,o){countVenue=++countVenue,o==google.maps.GeocoderStatus.OK&&(u=a[0].geometry.location,t(e,u,p))})})}function getInitLocal(e){var t;if(navigator.geolocation){var a=!0;navigator.geolocation.getCurrentPosition(function(a){t=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);var o=google.maps.geometry.spherical.computeDistanceBetween(t,iowaCity);if(32186.9>o){map.setCenter(t);var n="themes/afterclass2/images/position-indicator.png",i=new google.maps.Marker({position:t,map:map,icon:n});i.setMap(map)}else $("#mapLoaded").text("You're too far away from Iowa City. Here are events in Iowa City");e(t,pinAndDist)},function(){handleNoGeolocation(a)})}else{a=!1;var t=handleNoGeolocation(a)}}function genMap(){var e=new google.maps.Geocoder,t=new google.maps.StyledMapType(styles,{name:"Styled Map"}),a=document.createElement("div");a.id="mapcanvas",a.class="map-canvas",a.style.width="100%",jQuery(".NearMePage .map-container").append(a);var o={zoom:15,center:iowaCity,panControl:!1,mapTypeControl:!1,disableDefaultUI:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM}};map=new google.maps.Map(document.getElementById("mapcanvas"),o),map.mapTypes.set("map_style",t),map.setMapTypeId("map_style"),getInitLocal(venueGen)}function handleNoGeolocation(e){return initialLocation=iowaCity,map.setCenter(initialLocation),$("#status").text("Your location couldn't be detected. Showing events in Iowa City."),initialLocation}function error(e){var t=document.querySelector("#status");t.innerHTML="string"==typeof e?e:"failed",t.className="fail"}var markerArray=[],infowindow=new google.maps.InfoWindow({content:"holding...",maxWidth:340}),iowaCity=new google.maps.LatLng(41.661736,-91.540017),countVenue=0,venueFromMe={},venueCount=jQuery("#venuesWithEvents section").length;$(window).load(function(){$(".NearMePage .map-container").length&&genMap()});